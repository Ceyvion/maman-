<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#F0EEE9" />
  <meta name="description" content="Planning Jour MVP — Génération de planning jour conforme FPH" />
  <title>Planning Jour — MVP</title>
  <link rel="stylesheet" href="styles.css?v=20260219-cloud-dancer" />
  <style>
    /* Inline critical: prevent FOUC on hero */
    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      margin-bottom: 0.75rem;
      padding: 0.3rem 0.85rem;
      background: linear-gradient(135deg, #E8F0F5, #E4D8E8);
      border: 1px solid #D6DFE8;
      border-radius: 9999px;
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #4A7A8A;
    }
    .hero-badge svg { flex-shrink: 0; }
    .hero-subtitle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.375rem;
    }
    .hero-subtitle span {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: #8B8680;
      font-size: 0.85rem;
    }
    .hero-dot { color: #B8B4AE; }

    /* Panel icons */
    .panel-icon {
      display: flex;
      align-items: center;
      color: #8CAFC4;
      flex-shrink: 0;
    }
    .panel.is-active .panel-icon { color: #6A97B0; }

    /* Section icons */
    .section-icon {
      display: inline-flex;
      align-items: center;
      margin-right: 0.4rem;
      color: #8B8680;
    }

    /* Feedback area */
    #generation_feedback:not(:empty) {
      padding: 0.625rem 0.875rem;
      border-radius: 8px;
      background: #E8F0F5;
      color: #4A7A8A;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      border: 1px solid #D6DFE8;
    }
  </style>
</head>
<body>
  <main class="app">
    <header class="hero">
      <span class="hero-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        FPH Conforme
      </span>
      <h1>Planning Jour</h1>
      <div class="hero-subtitle">
        <span>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
          07:00 — 21:00
        </span>
        <span class="hero-dot">&middot;</span>
        <span>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
          Aucun shift de nuit
        </span>
      </div>
    </header>

    <!-- ══════════════════════════════════════════════════════════════
         SCREEN 1 — Parametres Planning
         ══════════════════════════════════════════════════════════════ -->
    <section class="panel is-active" id="screen-1" data-screen="screen-1">
      <button type="button" class="panel-header" data-panel-toggle="screen-1" aria-controls="screen-1-body" aria-expanded="true">
        <span class="panel-heading">
          <span class="panel-step">1</span>
          <span class="panel-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
          </span>
          <span class="panel-title">Parametres planning</span>
        </span>
        <span class="panel-meta">
          <span id="panel_status_screen-1" class="panel-status">A corriger</span>
          <span id="panel_summary_screen-1" class="panel-summary-line">Periode, mode et couverture.</span>
        </span>
      </button>
      <div class="panel-body" id="screen-1-body">
        <div class="simple-bar">
          <input id="simple_mode" type="checkbox" checked hidden />
          <button id="apply_recommended">Parametres recommandes</button>
          <span id="simple_mode_label" class="hint">Mode simple actif (recommande)</span>

        </div>

        <div id="quick_summary" class="quick-summary"></div>

        <div class="grid">
          <label>Service/Unite<input id="service_unit" value="USLD" /></label>
          <label>Debut<input id="start_date" type="date" value="2026-02-09" /></label>
          <label>Fin<input id="end_date" type="date" value="2026-02-15" /></label>
          <label>Mode
            <select id="mode">
              <option value="12h_jour">12h jour</option>
              <option value="matin_soir" selected>Matin-Soir</option>
              <option value="mixte">Mixte</option>
            </select>
          </label>
          <label>Besoin MATIN<input id="cov_matin" type="number" min="0" value="1" /></label>
          <label>Besoin SOIR<input id="cov_soir" type="number" min="0" value="1" /></label>
          <label>Besoin JOUR_12H<input id="cov_12h" type="number" min="0" value="0" /></label>
        </div>

        <details id="screen1_advanced" class="advanced-disclosure">
          <summary>Options avancees</summary>
          <div class="grid grid-advanced">
            <label class="advanced-param">Exception 12h mixte<input id="allow_12h_exception" type="checkbox" /></label>
            <label class="advanced-param">Max 12h/agent<input id="max_12h_exception" type="number" min="0" value="1" /></label>
            <label class="advanced-param">Date exception 12h<input id="exception_12h_date" type="date" /></label>
            <label class="advanced-param">Interdire M-S-M<input id="forbid_msm" type="checkbox" checked /></label>
            <label class="advanced-param">Utiliser tracker<input id="use_tracker" type="checkbox" checked /></label>
            <label class="advanced-param">Annee tracker<input id="tracker_year" type="number" min="2020" value="2026" /></label>
            <label class="advanced-param">Auto-ajout agents<input id="auto_add_agents" type="checkbox" checked /></label>
            <label class="advanced-param">Max renforts<input id="max_extra_agents" type="number" min="0" value="6" /></label>
            <label class="advanced-param">Enregistrer heures<input id="record_tracker" type="checkbox" /></label>
          </div>
        </details>

        <div class="actions">
          <button class="primary" data-next="screen-2">Suivant</button>
        </div>
      </div>
    </section>

    <!-- ══════════════════════════════════════════════════════════════
         SCREEN 2 — Agents
         ══════════════════════════════════════════════════════════════ -->
    <section class="panel is-collapsed" id="screen-2" data-screen="screen-2">
      <button type="button" class="panel-header" data-panel-toggle="screen-2" aria-controls="screen-2-body" aria-expanded="false">
        <span class="panel-heading">
          <span class="panel-step">2</span>
          <span class="panel-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </span>
          <span class="panel-title">Agents</span>
        </span>
        <span class="panel-meta">
          <span id="panel_status_screen-2" class="panel-status">A corriger</span>
          <span id="panel_summary_screen-2" class="panel-summary-line">Constituer l'equipe de planning.</span>
        </span>
      </button>
      <div class="panel-body" id="screen-2-body">
        <table class="agents">
          <thead>
            <tr><th>Nom</th><th>Prenom</th><th>Regime</th><th>Quotite</th><th class="advanced-col">Cible annuelle (h)</th><th>Indisponibilites (YYYY-MM-DD,...)</th></tr>
          </thead>
          <tbody id="agents_body"></tbody>
        </table>
        <div class="actions">
          <button data-back="screen-1">Retour</button>
          <button id="add_agent">Ajouter un agent</button>
          <button id="build_min_team">Equipe minimale</button>
          <button id="load_demo">Charger exemple</button>
          <button class="primary" data-next="screen-3">Suivant</button>
        </div>
      </div>
    </section>

    <!-- ══════════════════════════════════════════════════════════════
         SCREEN 3 — Generation & Resultats
         ══════════════════════════════════════════════════════════════ -->
    <section class="panel is-collapsed" id="screen-3" data-screen="screen-3">
      <button type="button" class="panel-header" data-panel-toggle="screen-3" aria-controls="screen-3-body" aria-expanded="false">
        <span class="panel-heading">
          <span class="panel-step">3</span>
          <span class="panel-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </span>
          <span class="panel-title">Generer</span>
        </span>
        <span class="panel-meta">
          <span id="panel_status_screen-3" class="panel-status">A corriger</span>
          <span id="panel3_stale_badge" class="panel-status panel-status-stale hidden">Stale</span>
          <span id="panel_summary_screen-3" class="panel-summary-line">Generez un planning pour afficher les resultats.</span>
        </span>
      </button>
      <div class="panel-body" id="screen-3-body">
        <div class="actions">
          <button data-back="screen-2">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Retour
          </button>
          <button class="primary" id="generate">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"><polygon points="5 3 19 12 5 21 5 3"/></svg>Generer
          </button>
          <button id="clear_locks">Reinitialiser verrous</button>
          <button id="print_planning">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>Imprimer
          </button>
          <button id="download_csv">Exporter CSV</button>
          <button id="download_pdf">Exporter PDF</button>
        </div>

        <div id="generation_feedback"></div>
        <div id="ready_check" class="ready-check"></div>
        <div id="stale_notice" class="stale-notice hidden">
          <span>Des modifications ont ete detectees. Regenerez pour synchroniser les resultats.</span>
          <button id="stale_regenerate" class="primary">Regenerer maintenant</button>
        </div>

        <div class="output">
          <!-- Planning -->
          <section class="subsection" data-section="planning">
            <button type="button" class="subsection-header" data-section-toggle="planning" aria-controls="subsection-planning" aria-expanded="true">
              <span>
                <span class="section-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                </span>
                Planning
              </span>
              <span class="subsection-chevron">&#9662;</span>
            </button>
            <div class="subsection-body" id="subsection-planning">
              <div id="print_summary" class="print-only"></div>
              <p class="hint">Clique sur une affectation pour la verrouiller/deverrouiller, puis regenere.</p>
              <div id="planning"></div>
            </div>
          </section>

          <!-- Live Activity -->
          <section class="subsection is-collapsed" data-section="live">
            <button type="button" class="subsection-header" data-section-toggle="live" aria-controls="subsection-live" aria-expanded="false">
              <span>
                <span class="section-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                </span>
                Suivi en temps reel
              </span>
              <span class="subsection-chevron">&#9656;</span>
            </button>
            <div class="subsection-body" id="subsection-live">
              <div class="live-toolbar">
                <label class="inline-control">Auto-refresh 10s<input id="live_auto_refresh" type="checkbox" checked /></label>
                <button id="refresh_live">Rafraichir live</button>
                <span id="live_server_time" class="hint"></span>
              </div>
              <div id="fr_compliance_notice" class="compliance-note"></div>
              <div class="live-form">
                <label>Affectation planifiee
                  <select id="live_assignment_select"></select>
                </label>
                <label>Statut
                  <select id="live_status">
                    <option value="planned">Prevu</option>
                    <option value="in_progress">En cours</option>
                    <option value="blocked">Bloque</option>
                    <option value="done">Termine</option>
                  </select>
                </label>
                <label>Tache
                  <input id="live_task_title" placeholder="Ex: Distribution medicaments" />
                </label>
                <label>Details
                  <input id="live_task_details" placeholder="Ex: Secteur A, priorites du matin (sans donnees patient)" />
                </label>
                <div class="actions">
                  <button id="add_live_task">Ajouter tache</button>
                </div>
              </div>
              <div id="live_entries"></div>
            </div>
          </section>

          <!-- Tracker -->
          <section class="subsection is-collapsed" data-section="tracker">
            <button type="button" class="subsection-header" data-section-toggle="tracker" aria-controls="subsection-tracker" aria-expanded="false">
              <span>
                <span class="section-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                </span>
                Tracker annuel
              </span>
              <span class="subsection-chevron">&#9656;</span>
            </button>
            <div class="subsection-body" id="subsection-tracker">
              <div class="actions">
                <button id="refresh_tracker">Rafraichir tracker</button>
              </div>
              <div id="tracker_view"></div>
            </div>
          </section>

          <!-- Compliance -->
          <section class="subsection is-collapsed" data-section="compliance">
            <button type="button" class="subsection-header" data-section-toggle="compliance" aria-controls="subsection-compliance" aria-expanded="false">
              <span>
                <span class="section-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </span>
                Conformite
              </span>
              <span class="subsection-chevron">&#9656;</span>
            </button>
            <div class="subsection-body" id="subsection-compliance">
              <div id="compliance_summary"></div>
              <pre id="compliance" class="compliance-json"></pre>
            </div>
          </section>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
